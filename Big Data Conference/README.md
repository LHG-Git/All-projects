# 🥈 2022 서울시 빅데이터 컨퍼런스
## 🚆 지하철 9호선 신설역 수요인원 예측 모델 개발 및 정책 제안
<center>![image](https://github.com/heegu0513/project/assets/100845169/327d25a9-9f23-43e5-8457-5a8c81aa1cba)</center>

<br>
지하철이라는 주제 특성상 많은 사람들이 흔하게 접할 수 있다는 점, 특히 출퇴근 시간에 지하철 내부의 혼잡률은 겉잡을 수 없이 심하기 때문에, 압사사고, 안전사고 등이 쉽게 일어날 수 있다는 점(당시 정말 안타깝게 발생한 이태원 참사사건으로, 혼잡률 그리고 밀집률에 대한 분석 주제가 아무래도 조금 더 관심을 받지 않았나라는 생각이 들었습니다.), 9호선의 경우 개통후 현재까지도 부정적인 여론이 형성되는 호선으로 주목받고 있는 와중에, 새로운 4개의 역 개통전에 효율적인 정책도입이 필요하다는 점으로 좋은 평가를 얻을 수 있었습니다. 
<br><br>

## 💡 주제 기획
* 특정한 시간(ex: 출퇴근 시간, 스포츠 경기시간 등)에 특정한 호선을 이용하게 되면 위험할 정도로 사람이 붐비는 밀집현상을 누구나 겪어봤을 것이라는 생각에서 해당 프로젝트의 아이디어를 기획하였습니다.<br><br>
* 기획을 하는 과정에서 지하철 관련 기사를 통해, 2028년 9호선에 추가 신설역 4개가 확장될 것이라는 내용과 9호선은 현재 ‘지옥철’ 혹은 ‘콩나물 시루’같이 별명만 들어도 숨이 막히는 호선으로 지목되고 있다는 내용을 확인하였고, 9호선의 경우 생긴 후 부터 현재까지도 부정적인 여론이 형성되는 호선으로 주목받고 있기 때문에, 이를 통해 프로젝트에서 진행할 주제를 9호선 신설역 수요예측 및 정책 제안으로 확정시켰습니다. 

## 💡 분석 기획
* 교통 도메인의 지식을 이해하고자, 교통 관련 현업에 계신 교통 데이터 분석 멘토님에게 자문을 구했습니다.<br><br>
* 지하철 수요예측 관련 레퍼런스를 참고하며, 지하철 수요예측에 이용될 데이터 수집과, 전처리 기법, EDA 그리고 모델링까지, 해당 프로젝트의 전체적인 흐름 및 아키텍처를 구상하여 팀원들과 소통하였습니다.<br><br>
* 모델의 성능을 올리기 위한 추가적인 데이터수집 및 변수 추가와 적절한 회귀모델 선택 그리고 하이퍼파라미터 튜닝까지, 모델 성능 향상에 대한 내용을 팀원들과 논의하며 프로젝트를 이끌어 나갔습니다.<br><br>

## 🔎 데이터 수집
### 1) 데이터 크롤링
* 서울시 지하철 9호선 신설역 수요인원 예측 모델을 개발하기 위해서 서울시 대학교 인원 정보, 서울시 중,고등학교 인원 정보를 크롤링하여 수집하였습니다.

### 2) 데이터 카운팅
* 서울시 지하철 9호선 신설역 수요인원 예측 모델을 개발하기 위해서 네이버 지도를 활용하여 노선 수, 출입구 수를 카운팅하여 수집하였습니다.

### 3) 데이터 검색
* 서울시 지하철 9호선 신설역 수요인원 예측 모델을 개발하기 위해서 각 호선별 지하철의 량 수를 검색을 통해 수집하였습니다.<br><br>

## 🔎 파생변수 생성
#### 1) 지하철 호선별, 역별 승하차 인원 정보
* 휴일이 누적 될 때마다 1일씩 추가하여 '누적휴일'이라는 파생변수를 생성하였습니다.

#### 2) 서울시 버스 정류장 공간데이터 정보
* Haversine을 사용해 지하철 역 반경 500m 시설물 개수를 추출하여 '버스정류장 개수'라는 파생변수를 생성하였습니다.

#### 3) 우수중소기업 공간데이터 정보
* Haversine을 사용해 지하철 역 반경 500m 시설물 개수를 추출하여 '중소기업 개수'라는 파생변수를 생성하였습니다.

#### 4) 서울시 주요시설과 집객시설 공간 데이터 정보
* Haversine을 사용해 지하철 역 반경 500m 시설물 개수를 추출하여 '행정', '교육/보건', '레저/관광/예술', '숙박/음식', '산업', '영화관 개수', '백화점 개수'라는 파생변수들을 생성하였습니다.

#### 5) 서울시 주요시설과 집객시설 공간 데이터 정보
* Haversine을 사용해 지하철 역 반경 500m 시설물 개수를 추출하여 '대학생수'라는 파생변수를 생성하였습니다.

#### 6) 서울시 주요시설과 집객시설 공간 데이터 정보
* Haversine을 사용해 지하철 역 반경 500m 시설물 개수를 추출하여 '공원 개수'라는 파생변수를 생성하였습니다.<br><br>

## 🔎 데이터 바운더리 
#### 1) 최고기온, 최저기온
* 최저 -12도이하, 최고 35도 이상 = 1 / 그 외의 온도 = 0 → '기온'이라는 파생변수를 생성하였습니다.

#### 2) 강수량
* 0mm: 정상/ 1-20mm: 약한비 / 21-50mm: 보통비 / 50-mm: 강한비 → '1일 우량'이라는 파생변수를 생성하였습니다.

#### 3) month
* 12-2월: 겨울 / 3-5월: 봄 / 6-8월: 여름 / 9-11월: 가을 → '계절'이라는 파생변수를 생성하였습니다.<br><br>

## 📊 EDA(탐색적 데이터 분석)
#### 1) 누적 휴일에 따른 총 승객수
* 휴일이 겹칠수록 승하차 수 감소 양상을 보였습니다.

#### 2) 한파/폭염 여부에 따른 총 승객수
* 승하차 수가 날씨의 영향을 받는다는 것을 확인할 수 있었습니다.

#### 3) 상업지역의 시간대별 승하차수
* 시간대별 특징이 두드러지지 않고, 골고루 유동인구가 분포되어 있었습니다.

#### 4) 주거지역의 시간대별 승하차수
* 주거지역에서는 오전에는 승차가, 오후에는 하차가 많은 것을 확인할 수 있었습니다.

#### 5) 업무지역의 시간대별 승하차수
* 업무지역에서는 오전에는 하차가, 오후에는 승차가 많은 것을 확인할 수 있었습니다.

#### 6) 역 반경 500m에 포함된 시설물
* 역별로 시설물 개수 차이가 확연하게 드러난다는 것을 확인할 수 있었습니다.

#### 7) 강수량에 따른 승하차수
* 비가 매우 많이 올 때가 비가 보통으로 오는 날 보다 오히려 승하차 수가 조금 증가한다는 것을 확인할 수 있었습니다.

#### 8) 계절에 따른 승하차수
* 방학 시즌에 대학교 역의 승하차수가 확실히 적은 경향이 있다는 것을 확인할 수 있었고, 월드컵 경기장역의 경우 스포츠 폐막 시기인 가을에 승하차수가 기하급수적으로 늘어난다는 것을 확인할 수 있었습니다.<br><br>

## 📄 K-means clustering
* 기계학습에 의한 클러스터링 결과 Group0은 52개의 역, Group1 82개의 역, Group2 37개의 역 결과가 나왔습니다. 

* Group0은 시간과 관계없이 승하차 분포가 고르기 때문에 상업그룹, Group1은 오전에는 승차에, 오후에는 하차에 분포가 되어 있기 때문에 주거그룹, Group2는 오전에는 하차에, 오후에는 승차에 분포가 되어 있기 때문에 업무그룹으로 지정하였습니다. 

* EDA과정에서 업무지역과 주거지역은 출퇴근 시간에 유동인구가 밀집되어 있다는 근거를 통해, Group1과 Group2를 통합하였습니다.

* <strong>클러스터링 기법을 통해 최종적으로 Group0(상업 그룹)과 Group1(업무주거 그룹)으로 나누었습니다.</strong><br><br><br>

## 📄 ANOVA검정
* EDA 및 분석을 통해 사용하고자 하는 변수(독립변수)가, 승하차인원 값(종속변수)에  미치는 영향이 통계적으로 유의한지 확인하기 위해 진행하였습니다.<br><br><br>

## 📄 변수선정
#### 1) 공통변수
* 노선명, 버스정류장 개수, 노선수, 계절, 기온, 공원 개수, 요일, 휴일여부, 누적휴일, 1일우량, 량
#### 2) 상업그룹 변수
* 산업, 숙박/음식, 레저/관광/예술, 영화관 개수, 백화점 개수
#### 3) 업무주거그룹 변수
* 행정, 대학생 수, 학생 수(중,고등), 교육/보건, 중소기업 개수<br><br>

## 📄 Hold-Out 검정
* <strong>Lidge, Lasso, RandomForest, Xgboost, DecisionTree, lightgbm</strong> 등 여러 회귀분석 모델 선택을 위해 Hold-Out검정을 진행하였습니다. 그 결과, LGBM모델이 가장 적합한 모델로 선정이 되었으며, 9호선 신설역 수요 예측을 LGBM모델을 이용하여 진행하기로 하였습니다.<br><br><br>

## MAE(평균 절대 오차)
<strong>MAE</strong>: 평균 절대 오차(실제 값과 예측 값의 차이)
• 회귀분석의 정확도를 판단하는 여러 값 중 MAE를 통해 모델의 성능 평가

## 📄 LightGBM 모델- 1차 성능평가
![image](https://github.com/heegu0513/project/assets/100845169/3cfedb7e-a70e-45bc-a8e9-95976cac3ba1)<br>
파란막대는 실제 승하차 데이터 값이고, 주황막대는 예측된 승하차 데이터 값입니다. x축은 몇 호선에 대한 내용, y축은 승하차에 대한 값입니다. 파라미터 조정 및 k-fold 교차검증을 이용하지 않고 LGBM모델의 default값 그대로 초기예측 진행 한 결과입니다.<br>
<strong>1차 결과로, 상업그룹의 경우 MAE(평균 절대 오차)값이 2600명 이었으며, 업무주거그룹의 경우 MAE값이 2100명 정도가 나오는 것을 확인할 수 있었습니다.</strong>

### 👍 모델 성능 향상
1) 최적의 하이퍼 파라미터 값을 이용하기 위해, 하이퍼파라미터 튜닝을 진행하였습니다.<br><br>
2) 노이즈 값을 없애고자, K-Fold 교차 검증을 진행하였습니다.

## LightGBM 모델- 2차 성능평가
![image](https://github.com/heegu0513/project/assets/100845169/2776b7f3-f7af-4039-b348-1231d362df3a)<br>
하이퍼 파라미터 튜닝을 통해, 최적의 파라미터 값을 지정해주었고, 5차 k-fold를 이용하여 노이즈 값을 최소화 시키고자 하였습니다.<br>
<strong>최종적으로 1차 결과에 비해 두 그룹의 오차 값(MAE)이 1000~1100명 정도 줄어 성능향상이 되었다.</strong>






